---
layout: post
title:  "Концепт пошаговости"
date:   2021-03-03 23:04:00 +0300
categories: pseudo-3d-js
---

# Концепт пошаговости

Разделение на "серверную" часть - сама игра, пошаговая, и "клиентскую" часть - интерфейс, в реалтайме. Пусть обе части работают на ECS для уменьшения переписывания кода на данном этапе, но система связи должна быть снаружи не ECS-based, чтобы можно было перейти на любую систему отображения.

## Задачи "сервера"(a.k.a. игра, a.k.a. ECS)
- Хранить состояние игровых сущностей
- Реализовывать механики игры
- Работать пошагово
- Сообщать внешним "слушателям" об изменениях в состоянии игрового мира

## Задачи "клиента"(a.k.a. интерфейс)
- Отрисовывать текущее состояние обозримых сущностей
- Сообщать игре о действиях пользователя: нажатие кнопки, тыкание в экран
- Реагировать на изменение состояния игры - "слушать" сервер

## Концепт событий
- Содержит задержку в ходах(только внутри игрового сервера)
- To be continued... *Music from JJBA*

# Идеи

## MVC
- ECS - модель, состояние игры - вьюха, приемщик команд - контроллер
- Клиент читает состояние игры и отрисовывает его
- Клиент передает команды, использует параметры, специфичные для данной команды
- Сервер реагирует на команды, изменяет состояние компонентов в ECS
- Сервер обновляет актуализирует состояние в соответствие с ECS

## Event Bus
- ECS открывает свой EventEmitter
- Интерфейс посылает команды в виде событий наравне с самой игрой
- Обе стороны имеют один общий формат событий

## YAEBus
- Интерфейс отправляет команды на Event Bus
- Event Bus записывает команду в какую-то часть состояния игры и запускает один игровой цикл
- Игровой цикл - не обязательно целый ход. Это может быть ход одного персонажа или попытка действия
- Игра проходит цикл и возвращает результат в тот же Event Bus
- Результат может содержать:
  - булево значение - результат выполнения команды
  - объект, описывающий изменения в состоянии игры, если таковые были
- Окончание хода пускай будет пока отдельной командой, которую в любом случае надо делать, чтобы закончить ход, даже если очки хода закончились

